<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>There and Back Again: A Data-Driven Journey</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Add DOMPurify for safe HTML content injection -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.6/purify.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IM+Fell+English:ital@0;1&family=Lora:wght@400;600&display=swap" rel="stylesheet">
    <style>
        /* --- Classic Cover-Inspired Theme (Green & Runes) --- */
        :root {
            --bg-parchment-green: #e8f0e4;
            --text-dark-ink: #262b25;
            --heading-green: #2e513a;
            --card-bg: #f5f1e6;
            --card-border: #a8b8a0;
            --accent-red: #c02c28;
            --accent-purple: #4c4c6d;
        }

        body {
            font-family: 'Lora', serif;
            background-color: var(--bg-parchment-green);
            color: var(--text-dark-ink);
        }
        h1, h2, h3, h4, h5, h6 {
            font-family: 'IM Fell English', serif;
            font-weight: 400;
            color: var(--heading-green);
            letter-spacing: 1px;
        }
        header h1 {
            color: var(--text-dark-ink);
        }
        header h2 {
            color: var(--accent-purple);
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 350px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 400px;
            }
        }
        .card {
            background-color: var(--card-bg);
            border: 1px solid var(--card-border);
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            border-radius: 3px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            text-align: left;
            padding: 12px;
            border-bottom: 1px solid var(--card-border);
        }
        th {
            background-color: rgba(46, 81, 58, 0.05);
            color: var(--heading-green);
        }
        .read-more-button {
            background-color: var(--bg-parchment-green);
            color: var(--heading-green);
            border: 1px solid var(--heading-green);
            transition: background-color 0.3s, color 0.3s;
            font-family: 'Lora', serif;
            font-weight: 600;
            cursor: pointer;
            border-radius: 5px;
            padding: 0.5rem 1rem;
            text-decoration: none;
        }
        .read-more-button:hover {
            background-color: var(--heading-green);
            color: var(--card-bg);
            text-decoration: none;
        }
        /* Improved Modal Styles */
        #contentModal {
             background-color: rgba(31, 31, 31, 0.85); /* Darker ink overlay */
        }
        #contentModal .card {
            background-color: var(--bg-parchment-green);
            border: 2px solid var(--heading-green);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        #modalContent p {
            margin-bottom: 1.25rem; /* Add spacing between paragraphs */
        }
        #modalContent p:last-child {
            margin-bottom: 0;
        }
        .rune-border {
            font-family: monospace;
            color: var(--heading-green);
            text-align: center;
            padding: 8px 0;
            border-top: 2px solid var(--card-border);
            border-bottom: 2px solid var(--card-border);
            /* Ensure consistent width */
            max-width: 80rem; /* Matches max-w-5xl (1280px) */
            margin-left: auto;
            margin-right: auto;
            overflow: hidden;
            white-space: nowrap;
            /* Animation properties */
            animation: runeFlicker 3s infinite alternate; /* Subtle flicker/pulsate */
        }

        @keyframes runeFlicker {
            0% { opacity: 1; text-shadow: none; }
            50% { opacity: 0.95; text-shadow: 0 0 2px rgba(46, 81, 58, 0.5); } /* Slight opacity change and subtle shadow */
            100% { opacity: 1; text-shadow: none; }
        }
    </style>
</head>
<body class="antialiased">

    <main class="container mx-auto p-4 md:p-8 max-w-5xl">

        <header class="text-center my-12">
            <div class="rune-border">
                <span>ᚠᛇᚻ᛫ᛒᛦᚦ᛫ᚠᚱᚩᚠᚢᚱ᛫ᚠᛁᚱᚪ᛫ᚷᛖᚻᚹᛦᛚᚳᚢᛗ᛫ᛋᚳᛖᚪᛚ᛫ᚦᛖᚪᚻ᛫ᛗᚪᚾᚾᚪ᛫ᚷᛖᚻᚹᛦᛚᚳ᛫ᛏᚱᛖᚩᚹ᛫ᚷᛁᚠᚪ᛫ᛞᚫᛚᚪᚾ᛫ᚷᛖᚻᚹᛦᛚᚳᚢᛗ</span>
            </div>
            <h1 class="text-4xl md:text-6xl mt-16">There and Back Again</h1> <!-- Increased top margin -->
            <h2 class="text-2xl md:text-3xl mt-2">A Chronological and Geographic Analysis of Bilbo Baggins's Journey</h2>
        </header>

        <!-- Section 1: The Measure of an Adventure -->
        <section class="mb-16 card p-6 md:p-8">
            <h3 class="text-2xl md:text-3xl mb-6 text-center">The Measure of an Adventure: Totals in Time and Distance</h3>
            <div class="text-lg leading-relaxed">
                <p>The tale of Bilbo Baggins's journey to the Lonely Mountain, as chronicled by J.R.R. Tolkien in *The Hobbit*, is an adventure of considerable scope, measurable in both time and distance. A precise understanding of these metrics provides not only a factual answer to the question of the journey's length but also offers a foundational context for appreciating the narrative's unique pacing and character. </p>
                <div class="text-right mt-4">
                    <button class="read-more-button" data-section="introduction">Read Full Introduction</button>
                </div>
            </div>
            
            <div class="overflow-x-auto my-8">
                <h4 class="text-xl mb-4">The Quest of Erebor at a Glance</h4>
                <table>
                    <thead>
                        <tr><th>Metric</th><th>Value</th></tr>
                    </thead>
                    <tbody>
                        <tr><td>Total Duration (There and Back Again)</td><td>Approx. <strong>14 months</strong> (April 27, 2941 - June 22, 2942)</td></tr>
                        <tr><td>Outward Journey Duration (Bag End to Erebor)</td><td>Approx. <strong>172 days</strong></td></tr>
                        <tr><td>Outward Journey Distance</td><td>Approx. <strong>950 miles</strong> (1529 km)</td></tr>
                        <tr><td>Average Daily Pace (Outward)</td><td>Approx. <strong>5.52 miles/day</strong> (8.88 km/day)</td></tr>
                    </tbody>
                </table>
            </div>
            <div class="mt-12 grid grid-cols-1 lg:grid-cols-2 gap-12 items-center">
                <div class="text-lg leading-relaxed">
                     <h4 class="text-xl mb-4">The Episodic Pace</h4>
                    <p>A journey of <strong>950 miles</strong> (1529 km) completed in <strong>172 days</strong> yields an average pace of just over <strong>5.5 miles per day</strong> (8.88 km/day). This rate of travel is remarkably slow for a determined party. This discrepancy cannot be explained by slow walking alone; it logically points to a journey composed of far more than just continuous travel. The low average pace is a mathematical indicator that the quest was episodic, punctuated by significant interruptions, long periods of rest, and unforeseen delays. This understanding reframes the entire narrative, shifting it from a simple A-to-B trek to a more complex, stop-and-start experience where the time spent stationary was as significant as the time spent in motion.</p>
                </div>
                <div class="chart-container">
                    <canvas id="paceChart"></canvas>
                </div>
            </div>
        </section>

        <!-- Section 2: The Outward Bound Road -->
        <section class="mb-16">
            <h3 class="text-2xl md:text-3xl text-center mb-12">The Outward Bound Road: A Detailed Itinerary</h3>
            
            <div class="space-y-4">
                <div class="card p-6">
                    <h4 class="text-xl font-bold">1. The Call to Adventure and the First Steps (April 26 - June 3, 2941)</h4>
                    <div class="text-lg leading-relaxed">
                        <p>The story begins not on the road, but with the "Unexpected Party" at Bag End on the evening of April 26, T.A. 2941. After a night of songs and talk of dragons, Bilbo rushes out on the morning of April 27 to join the Company of Thorin Oakenshield.</p>
                        <div class="text-right mt-4">
                            <button class="read-more-button" data-section="stage1">Read Full Details</button>
                        </div>
                    </div>
                </div>

                <div class="card p-6">
                    <h4 class="text-xl font-bold">2. A Fortnight's Respite in Rivendell (June 4 - Mid-year's Day, 2941)</h4>
                    <div class="text-lg leading-relaxed">
                        <p>After the hardships of the road, the company found sanctuary in the hidden valley of Rivendell. Here, they were hosted by Elrond, whose wisdom proved invaluable. By examining Thrór's map, Elrond revealed the secret moon-letters: "Stand by the grey stone when the thrush knocks...".</p>
                        <div class="text-right mt-4">
                            <button class="read-more-button" data-section="stage2">Read Full Details</button>
                        </div>
                    </div>
                </div>
                
                <div class="card p-6">
                    <h4 class="text-xl font-bold">3. Over the High Pass and Under the Mountains (Mid-year's Day - July, 2941)</h4>
                    <div class="text-lg leading-relaxed">
                        <p>Leaving the comfort of Rivendell, the company set out to cross the formidable Misty Mountains. They were captured by goblins, and it was during this flight that Bilbo was knocked unconscious and separated from the others.</p>
                        <div class="text-right mt-4">
                            <button class="read-more-button" data-section="stage3">Read Full Details</button>
                        </div>
                    </div>
                </div>

                <div class="card p-6">
                    <h4 class="text-xl font-bold">4. Into the Shadow of Mirkwood (August - September, 2941)</h4>
                     <div class="text-lg leading-relaxed">
                        <p>The company enters Mirkwood without Gandalf. Their journey through Mirkwood was an ordeal of hunger, thirst, and fear. After straying from the path, the dwarves were captured by Giant Spiders. It was Bilbo who, using his wits and his magic ring, managed to rescue them.</p>
                        <div class="text-right mt-4">
                            <button class="read-more-button" data-section="stage4">Read Full Details</button>
                        </div>
                    </div>
                </div>
                
                <div class="card p-6">
                    <h4 class="text-xl font-bold">5. Down the Forest River to Lake-town (September - October, 2941)</h4>
                    <div class="text-lg leading-relaxed">
                        <p>Bilbo devises a daring escape in barrels, arriving at Lake-town on his 51st birthday, September 22. After a <strong>two-week</strong> rest, they reach the Lonely Mountain and find the secret door on Durin's Day.</p>
                        <div class="text-right mt-4">
                            <button class="read-more-button" data-section="stage5">Read Full Details</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 3: The Aftermath -->
        <section class="mb-16 card p-6 md:p-8">
            <h3 class="text-2xl md:text-3xl mb-6 text-center">The Aftermath: Siege, Battle, and a King's Funeral <br> (October - November, 2941)</h3>
            <div class="text-lg leading-relaxed">
                <p>The arrival at the Lonely Mountain began the quest's climactic phase. After Smaug attacked Lake-town and was slain by Bard on October 1, 2941, Thorin succumbed to "dragon-sickness," refusing to share the hoard and leading to a tense siege.</p>
                <div class="text-right mt-4">
                    <button class="read-more-button" data-section="aftermath">Read Full Details</button>
                </div>
            </div>
        </section>

        <!-- Section 4: The Journey Home -->
        <section class="mb-16 card p-6 md:p-8">
            <h3 class="text-2xl md:text-3xl mb-6 text-center">The Journey Home: There and Back Again <br> (Late 2941 - June 22, 2942)</h3>
            <div class="text-lg leading-relaxed">
                <p>The return journey stands in stark contrast to the outward trek. Bilbo and Gandalf traveled a safer route north of Mirkwood and spent the entire winter as guests of Beorn, not departing until the spring of 2942.</p>
                <div class="text-right mt-4">
                    <button class="read-more-button" data-section="journeyHome">Read Full Details</button>
                </div>
            </div>
        </section>
        
        <!-- Section 6: Comparative Analysis -->
        <section class="mb-16">
            <h3 class="text-2xl md:text-3xl text-center mb-12">A Comparative Analysis: Bilbo's Quest vs. Frodo's</h3>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-center">
                 <div class="text-lg leading-relaxed card p-6">
                    <h4 class="text-xl mb-4">Key Statistical Differences and Their Narrative Implications</h4>
                    <p>To fully appreciate the scale of Bilbo's journey, it is useful to compare it to Frodo's. The statistical differences are stark and reveal the different narrative tones. Frodo's quest was a desperate flight, while Bilbo's was a treasure expedition.</p>
                    <div class="text-right mt-4">
                        <button class="read-more-button" data-section="comparison">Read Full Analysis</button>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="comparisonChart"></canvas>
                </div>
            </div>
            <div class="overflow-x-auto mt-12 card p-6">
                <h4 class="text-xl mb-4">Comparative Journey Metrics: Bilbo vs. Frodo</h4>
                <table>
                    <thead><tr><th>Metric</th><th>Bilbo's Journey (Outward)</th><th>Frodo's Journey (Outward)</th></tr></thead>
                    <tbody>
                        <tr><td><strong>Total Distance to Destination</strong></td><td>~<strong>950 miles</strong> (1529 km)</td><td>~<strong>1,800 miles</strong> (2897 km)</td></tr>
                        <tr><td><strong>Total Duration to Destination</strong></td><td><strong>172 days</strong></td><td><strong>185 days</strong></td></tr>
                        <tr><td><strong>Avg. Daily Pace to Rivendell</strong></td><td><strong>10.17 miles/day</strong> (16.37 km/day)</td><td><strong>16.9 miles/day</strong> (27.2 km/day)</td></tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Section 7: Conclusion -->
        <section class="card p-6 md:p-8">
            <h3 class="text-2xl md:text-3xl mb-6 text-center">Conclusion: The True Meaning of "An Adventure"</h3>
             <div class="text-lg leading-relaxed">
                <p class="mt-4 mb-4">The journey of Bilbo Baggins was a grand undertaking of approximately <strong>14 months</strong> and nearly <strong>2,000 miles</strong> (3219 km). Yet, to focus solely on these numbers is to miss their deeper significance. The duration and distance are the quantitative expression of the story's qualitative nature.</p>
                <p class="mt-4 mb-4">Ultimately, the most important measure of Bilbo's journey is not in miles or days, but in the growth of its protagonist. The time spent on the road and the distance crossed were the necessary crucible for his transformation. He left Bag End a respectable, comfort-loving hobbit, a "Baggins" through and through. He returned a worldly, courageous, and profoundly changed individual, one who had conversed with a dragon, tricked a king, and played a part in a great battle. The length and episodic structure of the journey were the conditions perfectly calibrated by the author to awaken the latent "Took" side of his character, fulfilling the promise that Gandalf had seen in him from the very beginning. The journey was long enough, and far enough, to take Bilbo Baggins there and back again, not just to a mountain of gold, but to a new version of himself.</p>
            </div>
        </section>

    </main>

    <footer class="text-center p-8 mt-12">
        <div class="rune-border">
             <span>ᛞᚢᚱᛁᚾ᛫ᚠᚩᛚᚳ᛫ᚢᚾᛞᛖᚱ᛫ᚦᛖ᛫ᛗᚩᚢᚾᛏᚪᛁᚾ᛫ᚱᛖᛏᚢᚱᚱᚾᛖᛞ᛫ᛏᚩ᛫ᛖᚱᛖᛒᚩᚱ᛫ᛚᚪᛋᛏ᛫ᚻᚩᛗᛖ᛫ᚩᚠ᛫ᛏᚻᚱᚪᛁᚾ</span>
        </div>
    </footer>

    <!-- Modal for Full Text -->
    <div id="contentModal" class="fixed inset-0 hidden items-center justify-center p-4 z-50">
        <div class="card p-6 md:p-8 max-w-2xl w-full relative">
            <div class="rune-border mb-4">
                 <span>ᚠᛇᚻ᛫ᛒᛦᚦ᛫ᚠᚱᚩᚠᚢᚱ</span>
            </div>
            <button id="closeModal" class="absolute top-4 right-4 text-2xl font-bold text-gray-600 hover:text-gray-900">&times;</button>
            <h3 id="modalTitle" class="text-2xl md:text-3xl mb-4 text-center">Details</h3>
            <div id="modalContent" class="text-lg leading-relaxed max-h-[60vh] overflow-y-auto">
                <!-- Content will be injected here -->
            </div>
             <div class="rune-border mt-4">
                 <span>ᛋᚳᛖᚪᛚ᛫ᚦᛖᚪᚻ᛫ᛗᚪᚾᚾᚪ</span>
            </div>
        </div>
    </div>

    <script>
        // --- Full Text Content Store ---
        const fullTexts = {
            introduction: `
                <p class="mb-6">The entire saga, from the moment Bilbo Baggins stepped out of his front door at Bag End to his eventual, and quite surprising, return, spanned approximately <strong>one year and two months</strong>. The Quest of Erebor commenced in the year 2941 of the Third Age (T.A.) and concluded with Bilbo's homecoming in T.A. 2942. More specifically, the adventure began with Bilbo's hasty departure on the morning of April 27, 2941, and officially ended when he arrived back at his own hobbit-hole on June 22, 2942, completing the full circle of "there and back again".</p>
                <p class="mb-6">The physical distance covered on this quest has been the subject of meticulous study, most authoritatively by the cartographer Karen Wynn Fonstad in her seminal work, *The Atlas of Middle-earth*. Her detailed analysis, based on Tolkien's maps and textual descriptions, has become the standard reference for the geography of Middle-earth. According to analyses derived from Fonstad's work, the outward journey from Hobbiton in the Shire to the Lonely Mountain (Erebor) covered a distance of approximately <strong>950 to 967 miles</strong> (1529 to 1556 km). While slight variations exist between different scholarly interpretations of Fonstad's data, the figure of <strong>950 miles</strong> (1529 km) for the outward journey, as calculated by the comprehensive LOTRProject, serves as a reliable and consistent metric. The return journey, though following a partially different and longer route, involved traversing a comparable distance, with the final leg from Rivendell back to Bag End alone measuring <strong>397 miles</strong> (639 km).</p>`,
            stage1: `
                <p class="mb-4">The company's first major leg of the journey took them east out of the familiar lands of the Shire and into the wilds of Eriador. Their path led them into the Trollshaws, where they had their first perilous encounter with the three stone-trolls, Tom, Bert, and William. Only Gandalf's clever imitation of their voices, which kept them arguing until the dawn turned them to stone, saved the dwarves from becoming a meal. This initial stage of the journey, from Bag End to the sanctuary of Rivendell, covered a distance of <strong>397 miles</strong> (639 km) and took the company <strong>39 days</strong> to complete. During this period of active travel, their pace was a more respectable, though still somewhat leisurely, average of <strong>10.17 miles per day</strong> (16.37 km/day).</p>`,
            stage2: `
                <p class="mb-4">This was no mere overnight stop. The company's stay in Rivendell was a significant period of rest and recuperation. They arrived in early June and did not depart until Mid-year's Day, the day between June and July in the Shire calendar. Detailed timeline analysis indicates this respite lasted for approximately <strong>29 days</strong>. This extended pause highlights the journey's nature: it was not a desperate flight but a planned expedition that allowed for strategic delays to rest, gather information, and prepare for the more dangerous road ahead.</p>`,
            stage3: `
                <p class="mb-4">It was here, on July 1, 2941, that the most pivotal event of the journey—and indeed, one of the most significant events of the Third Age—occurred: Bilbo stumbled upon a small, cold ring and put it in his pocket. Shortly after, he encountered the creature Gollum. In the famous Riddle Game that followed, Bilbo ultimately stumped Gollum and, by using the newfound power of the Ring to become invisible, managed to escape the creature's clutches and the goblin tunnels. After rejoining his companions, who were being harried by goblins and their Warg allies, the entire company was saved from certain doom by the timely intervention of the Great Eagles, who bore them away from the mountains.</p>`,
            stage4: `
                <p class="mb-4">Their journey through Mirkwood was an ordeal of hunger, thirst, and fear. After straying from the path, the dwarves were captured by Giant Spiders. It was Bilbo who, using his wits and his magic ring, managed to rescue them, slaying his first foe and naming his small sword "Sting." No sooner were they free from the spiders than they were captured again, this time by the Wood-elves of King Thranduil, who were wary of strangers in their realm. This period of captivity was another substantial delay in their quest. Analysis of the timeline suggests the dwarves were held prisoner in the Elvenking's halls for a period of <strong>26 days</strong>.</p>`,
            stage5: `
                <p class="mb-4">The entire segment of the quest from the time they left Rivendell to their arrival at the foot of the Lonely Mountain covered a distance of <strong>570 miles</strong> (917 km). As Elrond had foretold, they had to wait until Durin's Day, which fell in the last week of autumn. As the sun set on that day, its last ray revealed the keyhole, and Thorin was able to open the secret entrance. The company had reached its destination, and it was now time for the hobbit to earn his share of the treasure by entering the dragon's lair.</p>`,
            aftermath: `
                <h4 class="text-xl mt-6 mb-4">The Battle of Five Armies</h4>
                <p class="mb-4">Hoping to avert a needless war and force Thorin to negotiate, Bilbo took matters into his own hands. He secretly crept out of the mountain and delivered the Arkenstone—the Heart of the Mountain and the heirloom Thorin prized above all else—to Bard and Thranduil, to be used as a bargaining chip. Thorin was enraged by this act, which he saw as treason. The situation escalated with the arrival of a relief army of <strong>five hundred dwarves</strong> from the Iron Hills, led by Thorin's cousin, Dáin Ironfoot. A battle between the three armies of Dwarves, Men, and Elves seemed inevitable. At this critical moment, Gandalf reappeared, warning of a far greater danger: a massive army of Goblins from the Misty Mountains, led by Bolg, son of Azog, marching upon them with their Warg allies. This new threat forced the would-be enemies to unite. The resulting conflict, fought in the valley of Dale on October 10, 2941, became known as the Battle of Five Armies. The battle raged fiercely, and the alliance of Free Peoples was nearly overwhelmed until the tide was turned by the sudden arrival of the Great Eagles and, finally, Beorn, who entered the fray in his great bear form and crushed the goblin-chieftain Bolg.</p>
                <h4 class="text-xl mt-6 mb-4">The New Reign</h4>
                <p>The victory was decisive but came at a great cost. Thorin Oakenshield had been mortally wounded in the fighting. In his final moments, he reconciled with Bilbo, asking forgiveness for his harsh words and parting in friendship. His nephews, the young dwarves Fíli and Kíli, were also slain defending him. Thorin was laid to rest deep within the mountain, with the Arkenstone upon his breast. With Thorin's line ended, his cousin Dáin Ironfoot became the new King Under the Mountain. A new era of peace and prosperity began, with treasure being shared fairly, the town of Dale being rebuilt by Bard and his people, and good relations established between the Dwarves, Men, and Elves of the North.</p>`,
            journeyHome: `
                <h4 class="text-xl mt-6 mb-4">A Final Farewell and an Unwelcome Homecoming</h4>
                <p class="mb-4">They arrived back in Rivendell on May 1, 2942, where they stayed for a while with Elrond, resting and sharing tales of their adventures. After their pleasant stay in Rivendell, Bilbo traveled the final leg of his journey, covering the <strong>397 miles</strong> (639 km) back to the Shire. He arrived at Bag End on June 22, 2942, only to find a crowd of hobbits on his lawn and his possessions being auctioned off. Having been gone for over <strong>a year</strong>, he had been officially presumed dead by the authorities in Hobbiton. After a great deal of trouble and expense buying back his own furniture, and some legal wrangling, Bilbo was finally reinstated as being alive, though he had rather lost his reputation for respectability. This chaotic scene marked the true, and somewhat comical, end of his great adventure.</p>
                <p>The structure of the return journey serves as a narrative foil to the outward quest, highlighting the story's themes of change and homecoming. The outward journey was defined by a sense of urgency, constant danger, and a clear, time-sensitive objective: to reach the Lonely Mountain by Durin's Day. The path was fraught with immediate threats, from trolls and goblins to giant spiders and a fire-breathing dragon. In contrast, the return journey was characterized by a leisurely pace, safety, and reflection. The route was explicitly chosen to be less perilous, bypassing Mirkwood entirely. There was no deadline, no pressing need to rush. The most significant block of time on the return was not a hostile imprisonment but a voluntary and peaceful stay with an ally, Beorn, for an entire season. This thematic contrast underscores Bilbo's transformation. He left the Shire as a flustered, comfort-loving hobbit on a frightening quest; he returned a seasoned, wealthy, and worldly adventurer who could afford to take his time, enjoy the hospitality of powerful friends, and travel at his own pace. The very nature of his journey had changed because he himself had changed.</p>`,
            comparison: `
                <p class="mt-4 mb-4">Three core factors account for the disparity: the urgency of the mission, the composition of the company, and the ultimate purpose of the journey. First, the element of urgency was vastly different. Frodo's was a flight for his life and for the fate of the world, relentlessly hunted by the Nazgûl. Bilbo's quest, while dangerous, was fundamentally a treasure expedition. Second, the composition of the company played a critical role. Bilbo traveled with a large party of <strong>thirteen dwarves</strong>, while Frodo's Fellowship was more nimble and guided by Aragorn. Finally, the fundamental purpose of each mission shaped every decision. Bilbo's quest was one of reclamation; Frodo's was one of renunciation and destruction. The numbers are a direct reflection of the narrative's soul: one is an adventure story, the other is an epic of war and sacrifice.</p>`,
            conclusion: `
                <p class="mt-4 mb-4">Ultimately, the most important measure of Bilbo's journey is not in miles or days, but in the growth of its protagonist. The time spent on the road and the distance crossed were the necessary crucible for his transformation. He left Bag End a respectable, comfort-loving hobbit, a "Baggins" through and through. He returned a worldly, courageous, and profoundly changed individual, one who had conversed with a dragon, tricked a king, and played a part in a great battle. The length and episodic structure of the journey were the conditions perfectly calibrated by the author to awaken the latent "Took" side of his character, fulfilling the promise that Gandalf had seen in him from the very beginning. The journey was long enough, and far enough, to take Bilbo Baggins there and back again, not just to a mountain of gold, but to a new version of himself.</p>`
        };

        // --- DOM Elements ---
        const readMoreButtons = document.querySelectorAll('.read-more-button');
        const modal = document.getElementById('contentModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalContent = document.getElementById('modalContent');
        const closeModalButton = document.getElementById('closeModal');

        // --- Modal Logic ---
        function showModal(title, content) {
            modalTitle.textContent = title;
            // Use DOMPurify to sanitize content before injecting into innerHTML
            modalContent.innerHTML = DOMPurify.sanitize(content, {RETURN_TRUSTED_TYPE: false});
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        function hideModal() {
            modal.classList.add('hidden');
            modal.classList.remove('flex');
            modalContent.innerHTML = '';
        }

        // Add event listeners
        closeModalButton.addEventListener('click', hideModal);
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                hideModal();
            }
        });

        // --- Event Listeners for Read More Buttons ---
        readMoreButtons.forEach(button => {
            // Filter out the 'conclusion' button as its content is now directly displayed
            if (button.dataset.section === 'conclusion') {
                button.style.display = 'none'; // Hide the button
                return; // Skip adding event listener for this button
            }

            button.addEventListener('click', () => {
                const sectionKey = button.dataset.section;
                // Find the closest parent section or card and then its heading
                const parentSection = button.closest('.card, section');
                const sectionTitleElement = parentSection ? parentSection.querySelector('h3, h4') : null;
                const sectionTitle = sectionTitleElement ? sectionTitleElement.textContent : 'Details'; // Fallback title

                if (!Object.hasOwn(fullTexts, sectionKey)) {
                    console.error(`No full text found for section key: ${sectionKey}`);
                    return;
                }
                const content = fullTexts[sectionKey];
                showModal(sectionTitle, content);
            });
        });

        // --- Chart.js Setup ---
        const FONT_COLOR = '#1f1f1f';
        const GRID_COLOR = 'rgba(31, 31, 31, 0.1)';
        const PALETTE = {
            green: '#2e513a',
            red: '#c02c28',
            purple: '#4c4c6d',
        };

        const tooltipTitleCallback = (tooltipItems) => {
            const item = tooltipItems[0];
            let label = item.chart.data.labels[item.dataIndex];
            if (Array.isArray(label)) {
                return label.join(' ');
            }
            return label;
        };
        
        // Chart 1: Pace Chart
        const paceCtx = document.getElementById('paceChart').getContext('2d');
        const travelDays = 172 - 29 - 26 - 14; 
        const nonTravelDays = 29 + 26 + 14;
        new Chart(paceCtx, {
            type: 'doughnut',
            data: {
                labels: ['Travel & Action Days', 'Stationary Days'],
                datasets: [{
                    label: 'Days',
                    data: [travelDays, nonTravelDays],
                    backgroundColor: [PALETTE.green, PALETTE.purple],
                    borderColor: '#f5f1e6',
                    borderWidth: 4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'bottom', labels: { color: FONT_COLOR, font: { size: 12 }}},
                    title: { display: true, text: 'Breakdown of the 172-Day Outward Journey', color: FONT_COLOR, font: { size: 16, family: 'IM Fell English' }},
                    tooltip: { callbacks: { title: tooltipTitleCallback } }
                }
            }
        });

        // Chart 2: Comparison Chart
        const comparisonCtx = document.getElementById('comparisonChart').getContext('2d');
        const comparisonLabels = ['Total Distance (miles)', 'Total Duration (days)', 'Pace to Rivendell (mi/day)'];
        new Chart(comparisonCtx, {
            type: 'bar',
            data: {
                labels: comparisonLabels,
                datasets: [
                    { label: 'Bilbo', data: [950, 172, 10.17], backgroundColor: PALETTE.green },
                    { label: 'Frodo', data: [1800, 185, 16.9], backgroundColor: PALETTE.red }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: { 
                        beginAtZero: true, 
                        ticks: { color: FONT_COLOR }, 
                        grid: { color: GRID_COLOR }
                    },
                    x: { 
                        ticks: { color: FONT_COLOR, font: { size: 12 }}, 
                        grid: { display: false }
                    }
                },
                plugins: {
                    legend: { 
                        position: 'top', 
                        labels: { color: FONT_COLOR, font: { size: 14 }}
                    },
                    title: { 
                        display: true, 
                        text: 'Comparative Journey Metrics', 
                        color: FONT_COLOR, 
                        font: { size: 16, family: 'IM Fell English' }
                    },
                    tooltip: { 
                        callbacks: { title: tooltipTitleCallback } 
                    }
                }
            }
        });
    </script>
</body>
</html>
